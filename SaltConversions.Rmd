---
title: "Salt Conversions"
authors: "Amanda Pennino, Stephen Plont"
date: "4/5/2021"
output: html_document
---

```{r}
library(tidyverse)

```

```{r message= FALSE}

DATA <- read_csv("data/RawSalts_Clean.csv") 

#table(is.na(DATA$Minimum_concentration_original_num))


#When you turn these columns into numeric, anything non-numeric turns to "NA" and you lose the original data. Instead, let's create a new "original column" and populate with the numeric values. 

DATA$`Minimum_concentration_original_num` <- as.numeric(DATA$`Minimum_concentration_original`)
DATA$`Maximum_concentration_original_num` <- as.numeric(DATA$`Maximum_concentration_original`)

```


Step 1: Conversions of conductivity to uS/cm.
```{r}
DATA$Min_Conductivity_uScm=NA
DATA$Max_Conductivity_uScm=NA

#umhos/cm (umhos/cm = uS/cm)
umhos.cm<-subset(DATA, SaltUnits=="µmho/cm")
umhos.cm$Min_Conductivity_uScm=umhos.cm$Minimum_concentration_original_num
umhos.cm$Max_Conductivity_uScm=umhos.cm$Maximum_concentration_original_num
 
#dS/m (multiply by 100000 to get from deci to micro, divide by 100 to get from meter to centimeter)
dS.m<-subset(DATA, SaltUnits=="dS/m")
dS.m$Min_Conductivity_uScm=dS.m$Minimum_concentration_original_num*(100000/100)
dS.m$Max_Conductivity_uScm=dS.m$Maximum_concentration_original_num*(100000/100)

#mmhos/cm (mmhos/cm = mS/cm, multiply by 1000 to get from milli to micro)
mmhos.cm<-subset(DATA,SaltUnits=="mmhos/cm")
mmhos.cm$Min_Conductivity_uScm=mmhos.cm$Minimum_concentration_original_num*1000
mmhos.cm$Max_Conductivity_uScm=mmhos.cm$Maximum_concentration_original_num*1000

#uS/cm (uS/cm = uS/cm)
uS.cm<-subset(DATA,SaltUnits=="µS/cm")
uS.cm$Min_Conductivity_uScm=uS.cm$Minimum_concentration_original_num
uS.cm$Max_Conductivity_uScm=uS.cm$Maximum_concentration_original_num
       
#mS/cm (multiply by 1000 to get from milli to micro)
mS.cm<-subset(DATA,SaltUnits=="mS/cm")
mS.cm$Min_Conductivity_uScm=mS.cm$Minimum_concentration_original_num*1000
mS.cm$Max_Conductivity_uScm=mS.cm$Maximum_concentration_original_num*1000

#mS/m (multiply by 1000 to get from milli to micro, divide by 100 to get from meter to centimeter)
mS.m<-subset(DATA,SaltUnits=="mS/m")
mS.m$Min_Conductivity_uScm=mS.m$Minimum_concentration_original_num*10
mS.m$Max_Conductivity_uScm=mS.m$Maximum_concentration_original_num*10
    
#uS/m (divide by 100 to get from meter to centimeter)
uS.m<-subset(DATA,SaltUnits=="µS/m")
uS.m$Min_Conductivity_uScm=uS.m$Minimum_concentration_original_num/100
uS.m$Max_Conductivity_uScm=uS.m$Maximum_concentration_original_num/100

newDATA <-rbind(umhos.cm,dS.m,mmhos.cm,uS.cm,mS.cm,mS.m,uS.m)

newDATA <- newDATA %>% select(DataID, Min_Conductivity_uScm, Max_Conductivity_uScm)

DATA <- left_join(DATA, newDATA, by = "DataID")
DATA <- DATA %>% select(-c(Min_Conductivity_uScm.x, Max_Conductivity_uScm.x))

names(DATA)[names(DATA) == "Min_Conductivity_uScm.y"] <- "Min_Conductivity_uScm"
names(DATA)[names(DATA) == "Max_Conductivity_uScm.y"] <- "Max_Conductivity_uScm"

```


Step 2: Conversions ions-specific to ppm.
```{r}

IONS <- DATA %>% 
  filter(!Measurement %in% c("Salinity", "Natural Seawater", "Hardness", "Total Dissolved Solids", "NaCl dominant (ion matrix similar to seawater)","Varies (Table 4)", "Conductivity", "total suspended solids", "Specific Conductance"))                                   

IONS$Min_Concentration_ppm <- NA
IONS$Max_Concentration_ppm <- NA

##### ppt (parts per thousand)
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "ppt", 
                                         IONS$Minimum_concentration_original_num * 1000,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "ppt", 
                                         IONS$Maximum_concentration_original_num * 1000,
                                         IONS$Max_Concentration_ppm)


##### ppb
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "ppb", 
                                         IONS$Minimum_concentration_original_num / 1000,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "ppb", 
                                         IONS$Maximum_concentration_original_num / 1000,
                                         IONS$Max_Concentration_ppm)


##### g/L
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "g/L", 
                                         IONS$Minimum_concentration_original_num * 1000,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "g/L", 
                                         IONS$Maximum_concentration_original_num * 1000,
                                         IONS$Max_Concentration_ppm)


##### mg/L
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "mg/L", 
                                         IONS$Minimum_concentration_original_num, 
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "mg/L", 
                                         IONS$Maximum_concentration_original_num, 
                                         IONS$Max_Concentration_ppm)


##### ppm
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "ppm", 
                                         IONS$Minimum_concentration_original_num, 
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "ppm", 
                                         IONS$Maximum_concentration_original_num, 
                                         IONS$Max_Concentration_ppm)


##### ug/L
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "µg/L", 
                                         IONS$Minimum_concentration_original_num / 1000,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "µg/L", 
                                         IONS$Maximum_concentration_original_num / 1000,
                                         IONS$Max_Concentration_ppm)



##### %
# IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "%", 
#                                          IONS$Minimum_concentration_original_num * 10000,
#                                          IONS$Min_Concentration_ppm)
# 
# IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "%", 
#                                          IONS$Maximum_concentration_original_num * 10000,
#                                          IONS$Max_Concentration_ppm)



##### µmol/L

#NH4+
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "µmol/L" & IONS$Measurement== "NH4+", 
                                         IONS$Minimum_concentration_original_num / 1000000 * 1000 * 18.04,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "µmol/L" & IONS$Measurement== "NH4+", 
                                         IONS$Maximum_concentration_original_num / 1000000 * 1000 * 18.04,
                                         IONS$Max_Concentration_ppm)


#Ca2+
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits %in% c("µmol/L") & IONS$Measurement== "Ca2+", 
                                         IONS$Minimum_concentration_original_num / 1000000 * 1000 * 40.08,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits %in% c("µmol/L") & IONS$Measurement== "Ca2+", 
                                         IONS$Maximum_concentration_original_num / 1000000 * 1000 * 40.08,
                                         IONS$Max_Concentration_ppm)


#HCO3-
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "µmol/L" & IONS$Measurement== "HCO3-", 
                                         IONS$Minimum_concentration_original_num / 1000000 * 1000 * 61.02,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "µmol/L" & IONS$Measurement== "HCO3-", 
                                         IONS$Maximum_concentration_original_num / 1000000 * 1000 * 61.02,
                                         IONS$Max_Concentration_ppm)


#K+
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "µmol/L" & IONS$Measurement== "K+", 
                                         IONS$Minimum_concentration_original_num / 1000000 * 1000 * 39.09,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "µmol/L" & IONS$Measurement== "K+", 
                                         IONS$Maximum_concentration_original_num / 1000000 * 1000 * 39.09,
                                         IONS$Max_Concentration_ppm)

#Mg3+
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "µmol/L" & IONS$Measurement== "Mg3+", 
                                         IONS$Minimum_concentration_original_num / 1000000 * 1000 * 24.31,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "µmol/L" & IONS$Measurement== "Mg3+", 
                                         IONS$Maximum_concentration_original_num / 1000000 * 1000 * 24.31,
                                         IONS$Max_Concentration_ppm)


#Na+
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "µmol/L" & IONS$Measurement== "Na+", 
                                         IONS$Minimum_concentration_original_num / 1000000 * 1000 * 22.99,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "µmol/L" & IONS$Measurement== "Na+", 
                                         IONS$Maximum_concentration_original_num / 1000000 * 1000 * 22.99,
                                         IONS$Max_Concentration_ppm)




#mmol/L
#NaCl
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "NaCl", 
                                         IONS$Minimum_concentration_original_num / 1000 * 1000 * 58.44,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "NaCl", 
                                         IONS$Maximum_concentration_original_num / 1000 * 1000 * 58.44,
                                         IONS$Max_Concentration_ppm)



#Ca2+
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "Ca2+", 
                                         IONS$Minimum_concentration_original_num / 1000 * 1000 * 40.08,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "Ca2+", 
                                         IONS$Maximum_concentration_original_num / 1000 * 1000 * 40.08,
                                         IONS$Max_Concentration_ppm)



#K+
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "K+", 
                                         IONS$Minimum_concentration_original_num / 1000 * 1000 * 39.09,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "K+", 
                                         IONS$Maximum_concentration_original_num / 1000 * 1000 * 39.09,
                                         IONS$Max_Concentration_ppm)



#Mg3+
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "Mg3+", 
                                         IONS$Minimum_concentration_original_num / 1000 * 1000 * 24.31,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "Mg3+", 
                                         IONS$Maximum_concentration_original_num / 1000 * 1000 * 24.31,
                                         IONS$Max_Concentration_ppm)


#Na+
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "Na+", 
                                         IONS$Minimum_concentration_original_num / 1000 * 1000 * 22.99,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "Na+", 
                                         IONS$Maximum_concentration_original_num / 1000 * 1000 * 22.99,
                                         IONS$Max_Concentration_ppm)



#Cl-
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "Cl-", 
                                         IONS$Minimum_concentration_original_num / 1000 * 1000 * 35.45,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "Cl-", 
                                         IONS$Maximum_concentration_original_num / 1000 * 1000 * 35.45,
                                         IONS$Max_Concentration_ppm)


#CaCl2
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "CaCl2", 
                                         IONS$Minimum_concentration_original_num / 1000 * 1000 * 110.98,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "CaCl2", 
                                         IONS$Maximum_concentration_original_num / 1000 * 1000 * 110.98,
                                         IONS$Max_Concentration_ppm)

#KCl
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "KCl", 
                                         IONS$Minimum_concentration_original_num / 1000 * 1000 * 74.55,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "KCl", 
                                         IONS$Maximum_concentration_original_num / 1000 * 1000 * 74.55,
                                         IONS$Max_Concentration_ppm)


#NH4+
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "NH4+", 
                                         IONS$Minimum_concentration_original_num / 1000 * 1000 * 18.04,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "mmol/L" & IONS$Measurement== "NH4+", 
                                         IONS$Maximum_concentration_original_num / 1000 * 1000 * 18.04,
                                         IONS$Max_Concentration_ppm)


#uEq/L  
#NaHCO3, sodium bicarbonate
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "uEq/L" & IONS$Measurement== "NaHCO3", 
                                         IONS$Minimum_concentration_original_num / 1000 * 84.0,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "uEq/L" & IONS$Measurement== "NaHCO3", 
                                         IONS$Maximum_concentration_original_num / 1000 * 84.0,
                                         IONS$Max_Concentration_ppm)

#(NH4)2SO4 ; ammonium sulfate
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "uEq/L" & IONS$Measurement== "(NH4)2SO4", 
                                         IONS$Minimum_concentration_original_num / 1000 * 132.14,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "uEq/L" & IONS$Measurement== "(NH4)2SO4", 
                                         IONS$Maximum_concentration_original_num / 1000 * 132.14,
                                         IONS$Max_Concentration_ppm)


#KHCO3 ; potassium bicarbonate
IONS$Min_Concentration_ppm<-ifelse(IONS$SaltUnits== "uEq/L" & IONS$Measurement== "KHCO3", 
                                         IONS$Minimum_concentration_original_num / 1000 * 100.115,
                                         IONS$Min_Concentration_ppm)

IONS$Max_Concentration_ppm<-ifelse(IONS$SaltUnits== "uEq/L" & IONS$Measurement== "KHCO3", 
                                         IONS$Maximum_concentration_original_num / 1000 * 100.115,
                                         IONS$Max_Concentration_ppm)


IONS<- IONS %>% select(DataID, Min_Concentration_ppm, Max_Concentration_ppm)

DATA <- left_join(DATA, IONS, by = "DataID")


#ref <- IONS[(is.na(IONS$Max_Concentration_ppm)), ]

#Check for stragglers (no new data). Likely a name that needs to be fixed in 'DataCleaning' and then added above to conversDATA. 
```


What's left? 
Work on below.

Step 3: Converting TDS to conductivity.

Notes (SP 20210411)

-Lead on converting TDS to conductivity -> Correlation between conductivity and total dissolved solid in various type of water: A review
To cite this article: Anna F Rusydi 2018 IOP Conf. Ser.: Earth Environ. Sci. 118 012019
    -Pretty simple conversion factor, but changes for freshwater vs. salt water (so maybe we have a two compartment conversion?)

```{r}

#What and how many different units are we dealing with
Salinity<-subset(DATA, Measurement == "Salinity")
unique(sort(Salinity$SaltUnits))

TDS<-subset(DATA, Measurement == "Total Dissolved Solids" | Measurement == "total suspended solids" | Measurement == "total ions")
unique(sort(TDS$SaltUnits))

```


#Highlights in orange are the answers that Rich sent. They might still need to be changed in the "Data Cleaning.Rmd". Look below to confirm.
#Check to make sure they haven't already changed in the group sheet.
#Does the AllConductivity spreadsheet that Rich sent match the group sheet?
Notes from "Measurement = Conductivity"(SP 20210411)
-mhos
  -Recheck papers to see if there is a denominator in the unit (should be mhos/cm or mhos/m, etc.)
  -RefID = 217, Reviewer = Sally *(mhos/m) Changed manually in google drive salt data sheet. Download most recent version and re-run SaltCleaning!*
-mmhos
  -Recheck papers to see if there is a denominator in the unit (should be mmhos/cm or mmhos/m, etc.)
  -RefID = 406, Reviewer = Rich *(mhos/m) Changed manually in google drive salt data sheet. Download most recent version and re-run SaltCleaning!*
  

-mg/L
  -Recheck papers to see if this should be labeled under "conductivity" or as "salt/ion"
  -Or is the "mg/L" measurement linked to an ion or salt equivalent? (e.g., mg/L as Cl)
  -RefID = 453, Reviewer = Rich *(Road Runner Ice Melt; mostly NaCl and KCl) Changed manually in google drive salt data sheet. Download most recent version and re-run SaltCleaning!*
  -RefID = 506, Reviewer = Rich *(they report uS/cm and nothing about it being specific conductivity or not) NOT CHANGED*
  -RefID = 26, Reviewer = Abigail *(Specific Conductance) Changed manually in google drive salt data sheet. Download most recent version and re-run SaltCleaning!*
  -RefID = 266, Reviewer = Carl *(mg/L of Nitrate and unit for conductivity not given)  Why doesn't this work? NOT CHANGED*
  
  
-ug/L
  -Recheck papers to see if this should be labeled under "conductivity" or as "salt/ion"
  -Or is the "ug/L" measurement linked to an ion or salt equivalent? (e.g., ug/L as Cl)
  -RefID = 421, Reviewer = Abigail *(should actually be uS/cm; specific conductivity) Changed manually in google drive salt data sheet. Download most recent version and re-run SaltCleaning!*
  
  
-ppt
  -Recheck papers to see if this should be labeled under "conductivity" or as "salt/ion" or as "Total Dissolved Solids"
  -Or is the "ppt" measurement linked to an ion or salt equivalent? (e.g., ppt as Cl)
  -RefID = 409, Reviewer = Rich *(it is ppt of sea water) Changed manually in google drive salt data sheet. Download most recent version and re-run SaltCleaning!*
  -RefID = 107, Reviewer = Paul
-Not provided *(should be uS/cm; specific conductivity: 10-1200, already corrected in the google drive file)*
  -Should we just label these as NA's?  *(yes, NA is fine for this purpose. We had issues with too many people putting NAs everywhere when it was not appropriate, so we redid all NAs)*


Notes from "Measurement = Salinity" (SP 20210411)

RefID = 281, Reviewer = Abigail *(this is actually mS/cm specific conductivity) Changed manually in google drive salt data sheet. Download most recent version and re-run SaltCleaning!*


RefID = 496, Reviewer = Rich (*the units are mmol/L of the specific ion evaluated in the haemolymph, which is labeled in "specific_response_metric" column (sodium, chloride, or potasium); was a very confusing paper, for sure) NOT CHANGED*

```{r}

    #mhos
    #***RECHECK UNITS IN PAPER***
    mhos<-subset(DATA,SaltUnits=="mhos")
    mhos$Min_Conductivity_uScm=NA
    mhos$Max_Conductivity_uScm=NA

    #mhmos
    #***RECHECK UNITS IN PAPER***
    mmhos<-subset(DATA,SaltUnits=="mhmos")
    mmhos$Min_Conductivity_uScm=NA
    mmhos$Max_Conductivity_uScm=NA
    
Conductivity<-subset(DATA, Measurement == "Conductivity")

    #mg/L
    #***RECHECK UNITS/TYPE OF MEASUREMENT IN PAPER***
    mg.L<-subset(Conductivity,SaltUnits=="mg/L")
    mg.L$Min_Conductivity_uScm=NA
    mg.L$Max_Conductivity_uScm=NA
    
    #ug/L
    #***RECHECK UNITS/TYPE OF MEASUREMENT IN PAPER***
    ug.L<-subset(Conductivity,SaltUnits=="µg/L")
    ug.L$Min_Conductivity_uScm=NA
    ug.L$Max_Conductivity_uScm=NA
    
    #ppt
    #***RECHECK UNITS/TYPE OF MEASUREMENT IN PAPER***
    ppt<-subset(Conductivity,SaltUnits=="ppt")
    ppt$Min_Conductivity_uScm=NA
    ppt$Max_Conductivity_uScm=NA
    
    #Not provided
    #***RECHECK UNITS IN PAPER***
    notprovided<-subset(Conductivity,SaltUnits=="Not provided")
    notprovided$Min_Conductivity_uScm=NA
    notprovided$Max_Conductivity_uScm=NA

ALLCOND<-rbind(newDATA,mhos,mmhos,mg.L,ug.L,ppt,notprovided)
write.csv(ALLCOND, "allconductivitystudies.csv")

unique(ALLCOND$RefID)
```

